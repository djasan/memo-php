C'est parti pour un plongeon dans les profondeurs techniques du blog !

Vous pouvez rÃ©cupÃ©rer le code pour ce chapitre du cours en zip sur le Github du cours.

Vous Ãªtes confiant avec Git ? Vous pouvez rÃ©cupÃ©rer le code qui sert de support Ã  ce cours en tÃ©lÃ©chargeant le dÃ©pÃ´t Git Adoptez une architecture MVC en PHP. Vous pourrez ensuite travailler dessus directement depuis votre ordinateur ! Et pour les autres, ne vous faites pas de souci : vous aurez un lien vers le code lisible sur Github Ã  chaque chapitre.

Si on se concentre uniquement sur le cÃ´tÃ© visiteur, celui-ci affiche une liste de billets depuis la base de donnÃ©es :
Le super blog de l'AVBN montre deux billets d'actualitÃ©.
AperÃ§u du rÃ©sultat du TP blog

Le code de cette page tient dans un fichier  index.php . Voici le code qui avait Ã©tÃ© Ã©crit (j'ai juste retirÃ© le lien vers la page des commentaires pour rester simple pour l'instant) :

<!DOCTYPE html>

<html>

   <head>

    <meta charset="utf-8" />

    <title>Le blog de l'AVBN</title>

    <link href="style.css" rel="stylesheet" />

   </head>


   <body>

    <h1>Le super blog de l'AVBN !</h1>

    <p>Derniers billets du blog :</p>


    <?php

    // Connexion Ã  la base de donnÃ©es

    try

    {

        $bdd = new PDO('mysql:host=localhost;dbname=blog;charset=utf8', 'blog', 'password');

    }

    catch(Exception $e){

            die( 'Erreur : '.$e->getMessage()   );

    }


    // On rÃ©cupÃ¨re les 5 derniers billets

    $req = $bdd->query('SELECT id, titre, contenu, DATE_FORMAT(date_creation, \'%d/%m/%Y Ã  %Hh%imin%ss\') AS date_creation_fr FROM billets ORDER BY date_creation DESC LIMIT 0, 5');


    while ($donnees = $req->fetch())

    {

    ?>

    <div class="news">

        <h3>

            <?php echo htmlspecialchars($donnees['titre']); ?>

            <em>le <?php echo $donnees['date_creation_fr']; ?></em>

        </h3>

        <p>

        <?php

        // On affiche le contenu du billet

                echo    nl2br ( htmlspecialchars( $donnees['contenu']));

        ?>

        <br />

        <em><a href="#">Commentaires</a></em>

        </p>

    </div>

    <?php

    } // Fin de la boucle des billets

    $req->closeCursor();

    ?>

   </body>

</html>

Si vous avez bien lu le chapitre prÃ©cÃ©dent, il y a des dÃ©fauts qui devraient vous sauter aux yeux. ğŸ‘€

    Le code est en franÃ§ais. Pour le titre de la page ("Le blog de l'AVBN") et les autres informations affichÃ©es Ã  l'utilisateur, c'est normal. Par contre, le code PHP lui-mÃªme ne devrait pas Ãªtre en franÃ§ais (par exemple la variable $donnees). C'est mauvais, car le code ne pourra pas Ãªtre lu par des dÃ©veloppeurs qui ne parlent pas franÃ§ais.

    Le formatage ne respecte aucune rÃ¨gle. Les tabulations n'ont pas toujours le mÃªme nombre d'espaces â€“ et encore, quand il y a des tabulations. Les accolades se baladent oÃ¹ bon leur semble. Et j'en passe. Il est beaucoup plus difficile de s'y retrouver et donc de comprendre la logique du code Ã©crit.

    Tout est dans un seul fichier. On y mÃ©lange des opÃ©rations en PHP, des requÃªtes SQL et du code HTML. Il ne manquerait plus que du code CSS au milieu et Ã§a serait le pompon ! Pas Ã©tonnant qu'on ait besoin de commentaires pour se repÃ©rer dans les diffÃ©rentes sections du fichier.

Le fichier commence par du HTML, suivi par du PHP, SQL, PHP et encore du HTML.
HTML, PHP, SQL, PHP, HTML, PHP... on mÃ©lange un peu trop les choses ici !

Je ne comprends pas. Ce code fonctionne, non ? Ã‡a ne suffit pas ?

Il fonctionne, certes. Mais si vous commencez Ã  ajouter de nouvelles fonctionnalitÃ©s, vous allez avoir besoin d'ajouter de nouvelles requÃªtes SQL au milieu. TrÃ¨s vite, le fichier va grossir et faire plusieurs centaines de lignes. Ã‡a marchera toujours. Ã‡a ne sera mÃªme pas forcÃ©ment plus lent.

Par contre, Ã  chaque fois que vous allez ouvrir votre fichier, vous allez pousser un grand soupir :

    "Pfff, qu'est-ce que j'avais fait dÃ©jÃ  ? Hmm, lÃ  c'Ã©tait Ã  peu prÃ¨s l'endroit qui s'occupait de Ã§a. Bon je modifie ici... ah merde Ã§a plante. Ah oui, c'est vrai, il y avait aussi un truc Ã  modifier Ã  un autre endroit du fichier pour que Ã§a marche. Oh lÃ  lÃ , Ã§a fait dÃ©jÃ  4 heures que j'essaye de faire Ã§a, je suis perdu, c'est trop compliquÃ© la programmation !"

Et bien sÃ»r, n'oubliez pas que la plupart du temps les projets se font en Ã©quipe. Jenny, qui fait l'intÃ©gration HTML et CSS du site, va devoir naviguer entre vos fonctions PHP. De votre cÃ´tÃ©, vous vous perdrez au milieu de ses imbrications de balises. Et au moment de rassembler votre travail, ce sera la fÃªte des conflits Git !

Pour des raisons de pudeur, la citation de Jenny en train de rÃ©soudre ces conflits de code sera remplacÃ©e par des Ã©mojis.

    ğŸ˜

    â‰ï¸ğŸ¤”

    ğŸ™„ ğŸ˜‘

    ğŸ˜¡

    ğŸ’©

    â€¼ï¸ ğŸ”« ğŸ’£ ğŸ—¡ ğŸ—¯ ğŸ’€ â˜ ï¸

Bref, vous avez compris : cette personne va souhaiter trÃ¨s fort ne plus jamais avoir Ã  travailler sur ce projet !

Pour vous Ã©viter ce genre de situation, je vais vous montrer comment on peut mieux organiser ce code en le dÃ©coupant. Allons-y par Ã©tapes !

Si vous voulez voir le code avant nos modifications, voici le lien pour le tÃ©lÃ©charger en zip Ã  partir du Github. 

Si vous Ãªtes Ã  lâ€™aise avec Git, vous pouvez suivre le lien vers l'Ã©tiquette Github de cette Ã©tape, pour le tester. Une fois que vous avez clonÃ© le dÃ©pÃ´t, faites un  git checkout apprehendez-limites-code-debutant  pour vous retrouvez sur la bonne Ã©tiquette. MÃ©morisez bien cette commande, vous en aurez besoin !
